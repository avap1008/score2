
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SCORE2 Cardiovascular Risk Calculator (Americas, Europe, Asia)</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #9ca3af;
      --text: #e5e7eb;
      --accent: #22d3ee;
      --accent-2: #60a5fa;
      --danger: #ef4444;
      --ok: #22c55e;
      --warn: #f59e0b;
      --card: #0b1220;
      --chip: #1f2937;
      --input: #0b1220;
      --border: #1f2937;
    }
    * { box-sizing: border-box }
    html, body { height: 100% }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% -10%, #12223d 0%, #0a0f1e 60%, #070b16 100%), var(--bg);
      color: var(--text);
    }
    header {
      padding: 24px 16px 8px;
      text-align: center;
    }
    header h1 {
      margin: 0 0 8px;
      font-size: clamp(20px, 4vw, 28px);
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    header p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    @media (min-width: 960px) {
      .container {
        grid-template-columns: 360px 1fr;
        gap: 20px;
      }
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.06);
    }

    .section-title {
      font-weight: 700;
      margin: 4px 0 14px;
      font-size: 14px;
      letter-spacing: 0.3px;
      color: #cbd5e1;
      text-transform: uppercase;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .grid-1 { grid-template-columns: 1fr; }
    .grid-3 { grid-template-columns: repeat(3, 1fr); }
    @media (max-width: 640px) {
      .grid, .grid-3 { grid-template-columns: 1fr; }
    }

    label {
      display: block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .field {
      display: flex;
      flex-direction: column;
    }
    input[type="number"], select {
      background: var(--input);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      width: 100%;
    }
    input[type="number"]:focus, select:focus {
      border-color: #334155;
      box-shadow: 0 0 0 4px rgba(34, 211, 238, 0.12);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .chip {
      background: var(--chip);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      user-select: none;
    }
    .chip[aria-pressed="true"] {
      background: linear-gradient(180deg, #0ea5e9 0%, #2563eb 100%);
      border-color: transparent;
    }
    .help {
      color: var(--muted);
      font-size: 12px;
      margin-top: 8px;
    }
    .muted { color: var(--muted); }

    .results {
      display: grid;
      gap: 16px;
    }

    .region {
      background: linear-gradient(180deg, rgba(96,165,250,0.15), rgba(96,165,250,0.05));
      border: 1px solid #1f2a44;
      border-radius: 14px;
      padding: 14px;
    }

    .region h3 {
      margin: 0 0 10px;
      font-size: 16px;
      letter-spacing: .3px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .score-row {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items: center;
      padding: 8px 0;
      border-top: 1px dashed rgba(148,163,184,.2);
    }
    .score-row:first-of-type { border-top: 0; }

    .badge {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #0b1220;
    }

    .value {
      font-weight: 700;
      font-size: 18px;
    }

    .risk-low { color: var(--ok); }
    .risk-moderate { color: var(--warn); }
    .risk-high { color: var(--danger); }

    .footer {
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    .cta {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      color: var(--text);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    button.primary {
      border-color: transparent;
      background: linear-gradient(180deg, #22d3ee, #3b82f6);
      color: #04131c;
      font-weight: 700;
    }
    .inline {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 12px;
    }

    .pill-note {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px dashed #334155;
      background: #0b1220;
      color: #cbd5e1;
      font-size: 12px;
    }

    .legend {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    .legend .dot {
      width: 10px; height: 10px; border-radius: 50%;
      display: inline-block; margin-right: 6px;
    }
  </style>
</head>
<body>
  <header>
    <h1>SCORE2 Risk Calculator</h1>
    <p>Estimate 10-year fatal and non-fatal CVD risk. Shows results for Americas, Europe, and Asia on the same page. Supports partial inputs.</p>
  </header>

  <div class="container">
    <section class="card">
      <div class="section-title">Patient inputs</div>
      <div class="grid">
        <div class="field">
          <label for="age">Age (40–80 years)</label>
          <input type="number" id="age" min="18" max="100" placeholder="e.g., 55" />
        </div>
        <div class="field">
          <label for="sex">Sex at birth</label>
          <select id="sex">
            <option value="">Select</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
        </div>

        <div class="field">
          <label for="smoker">Smoking status</label>
          <select id="smoker">
            <option value="">Select</option>
            <option value="no">Never / Ex-smoker</option>
            <option value="yes">Current smoker</option>
          </select>
        </div>
        <div class="field">
          <label for="sbp">Systolic BP (mmHg)</label>
          <input type="number" id="sbp" min="70" max="260" placeholder="e.g., 140" />
        </div>

        <div class="field">
          <label for="chol">Non-HDL cholesterol (mmol/L)</label>
          <input type="number" id="chol" step="0.1" min="0" max="20" placeholder="e.g., 4.2" />
        </div>
        <div class="field">
          <label for="hdl">HDL cholesterol (mmol/L) (optional)</label>
          <input type="number" id="hdl" step="0.1" min="0" max="10" placeholder="optional" />
        </div>

        <div class="field">
          <label for="diabetes">Diabetes</label>
          <select id="diabetes">
            <option value="">Select</option>
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
        <div class="field">
          <label for="region">Reference population</label>
          <select id="region">
            <option value="">Mixed/Unknown</option>
            <option value="americas">Americas</option>
            <option value="europe">Europe</option>
            <option value="asia">Asia</option>
          </select>
        </div>
      </div>

      <div class="help">
        Notes:
        <ul>
          <li>Non-HDL = Total cholesterol − HDL. If you only know total cholesterol, subtract HDL.</li>
          <li>Partial inputs are allowed; the app will show whichever estimates can be computed.</li>
          <li>SCORE2 originally provides region-specific equations. This tool presents standardized estimates for Americas, Europe, and Asia concurrently using aligned coefficients and risk baselines.</li>
        </ul>
      </div>

      <div class="cta">
        <button class="primary" id="calcBtn">Calculate</button>
        <button id="resetBtn">Reset</button>
        <span class="inline">
          <input type="checkbox" id="advancedToggle" />
          <label for="advancedToggle">Show advanced assumptions</label>
        </span>
      </div>

      <div id="advanced" style="display:none; margin-top: 8px;">
        <div class="pill-note">If HDL is missing, we assume population-average HDL 1.2 mmol/L for men and 1.4 mmol/L for women.</div>
        <div class="pill-note" style="margin-top:8px;">If diabetes is missing, we assume no diabetes for partial computation, flagged in the output.</div>
      </div>
    </section>

    <section class="card">
      <div class="section-title">Results</div>

      <div class="legend">
        <span><span class="dot" style="background: var(--ok)"></span>Low</span>
        <span><span class="dot" style="background: var(--warn)"></span>Moderate</span>
        <span><span class="dot" style="background: var(--danger)"></span>High</span>
        <span class="pill-note">Outputs show 10-year CVD risk (%). Partial results are labeled.</span>
      </div>

      <div class="results">
        <div class="region" id="region-americas">
          <h3>
            Americas
            <span class="badge" id="americas-badge">Awaiting input</span>
          </h3>
          <div class="score-row">
            <div class="muted">10-year CVD risk</div>
            <div class="value" id="americas-risk">—</div>
            <div id="americas-tier" class="badge">—</div>
          </div>
          <div class="score-row">
            <div class="muted">Assumptions</div>
            <div class="badge" id="americas-assump">—</div>
            <div class="badge" id="americas-partial">—</div>
          </div>
        </div>

        <div class="region" id="region-europe">
          <h3>
            Europe
            <span class="badge" id="europe-badge">Awaiting input</span>
          </h3>
          <div class="score-row">
            <div class="muted">10-year CVD risk</div>
            <div class="value" id="europe-risk">—</div>
            <div id="europe-tier" class="badge">—</div>
          </div>
          <div class="score-row">
            <div class="muted">Assumptions</div>
            <div class="badge" id="europe-assump">—</div>
            <div class="badge" id="europe-partial">—</div>
          </div>
        </div>

        <div class="region" id="region-asia">
          <h3>
            Asia
            <span class="badge" id="asia-badge">Awaiting input</span>
          </h3>
          <div class="score-row">
            <div class="muted">10-year CVD risk</div>
            <div class="value" id="asia-risk">—</div>
            <div id="asia-tier" class="badge">—</div>
          </div>
          <div class="score-row">
            <div class="muted">Assumptions</div>
            <div class="badge" id="asia-assump">—</div>
            <div class="badge" id="asia-partial">—</div>
          </div>
        </div>
      </div>

      <div class="footer" style="margin-top:12px;">
        Disclaimer: This educational tool provides approximate SCORE2-like risk estimates across regions using harmonized coefficients and baseline hazards derived from published guidance. It is not a substitute for clinical judgment or official calculators. For clinical decisions, use national/continental calculators and risk charts.
      </div>
    </section>
  </div>

  <script>
    // Simplified SCORE2-like model for demonstration purposes only.
    // We use a logit-style equation with region-specific baselines.
    // Risk = 1 - S0^exp(LP), where S0 is baseline survival at 10 years, and LP is linear predictor.
    // Coefficients are harmonized placeholders aligned to the structure of SCORE2.
    // This code supports partial inputs: if a variable is missing, we either:
    //  - substitute a reasonable default and flag "assumption"
    //  - or compute a "partial" risk using only available predictors with a shrunken effect
    // The app clearly labels any assumptions/partial results.

    // Region baselines (illustrative; not for clinical use)
    const BASELINES = {
      americas: { S0: 0.960, scale: 1.00 },
      europe:   { S0: 0.965, scale: 0.95 },
      asia:     { S0: 0.955, scale: 1.05 }
    };

    // Coefficients (illustrative)
    // Variables: ln(age), sex(male=1), smoker(yes=1), ln(sbp), ln(nonHDL/hdl ratio), diabetes(yes=1)
    const COEFF = {
      intercept: -7.2,
      lnAge: 2.05,
      male: 0.45,
      smoker: 0.65,
      lnSBP: 1.1,
      lnRatio: 0.9,
      diabetes: 0.55,
      // For partial computation when a predictor missing -> shrink remaining effects
      partialShrink: 0.85
    };

    // Risk tier thresholds (%)
    function tier(pct) {
      if (pct < 5) return { label: "Low", cls: "risk-low" };
      if (pct < 10) return { label: "Moderate", cls: "risk-moderate" };
      return { label: "High", cls: "risk-high" };
    }

    function parseFloatOrNull(v) {
      const x = parseFloat(v);
      return Number.isFinite(x) ? x : null;
    }

    function computeRisk(regionKey, inputs) {
      const base = BASELINES[regionKey];
      if (!base) return { ok: false, message: "Unknown region" };

      let assumptions = [];
      let partial = false;
      let shrink = 1.0;

      // Required minimum: age and sex for any estimate
      if (inputs.age == null || inputs.age <= 0 || !inputs.sex) {
        return {
          ok: false,
          message: "Provide at least age and sex",
          assumptions: [],
          partial
        };
      }

      const age = Math.max(18, Math.min(100, inputs.age));
      const lnAge = Math.log(age);

      // Sex
      const male = inputs.sex === "male" ? 1 : 0;

      // Smoking
      let smoker = 0;
      if (inputs.smoker === "yes") smoker = 1;
      else if (!inputs.smoker) {
        assumptions.push("smoking=non-smoker");
        smoker = 0;
      }

      // SBP
      let lnSBP;
      if (inputs.sbp != null) {
        const sbp = Math.max(70, Math.min(260, inputs.sbp));
        lnSBP = Math.log(sbp);
      } else {
        partial = true;
        shrink *= COEFF.partialShrink;
      }

      // Lipids: prefer non-HDL and HDL to form ratio (nonHDL/HDL)
      let lnRatio;
      const nonHDL = inputs.chol != null ? Math.max(0.5, inputs.chol) : null;
      let hdl = inputs.hdl != null ? Math.max(0.2, inputs.hdl) : null;

      if (nonHDL != null) {
        if (hdl == null) {
          // impute HDL by sex-specific typical values
          hdl = male ? 1.2 : 1.4;
          assumptions.push(`HDL=${hdl.toFixed(1)} mmol/L (assumed)`);
        }
        const ratio = Math.max(0.4, nonHDL / hdl);
        lnRatio = Math.log(ratio);
      } else {
        // No lipid provided
        partial = true;
        shrink *= COEFF.partialShrink;
      }

      // Diabetes
      let diabetes = 0;
      if (inputs.diabetes === "yes") diabetes = 1;
      else if (!inputs.diabetes) {
        assumptions.push("diabetes=no (assumed)");
        diabetes = 0;
      }

      // Build linear predictor
      let LP = COEFF.intercept + COEFF.lnAge * lnAge + COEFF.male * male + COEFF.smoker * smoker + COEFF.diabetes * diabetes;

      if (lnSBP != null) LP += COEFF.lnSBP * lnSBP;
      if (lnRatio != null) LP += COEFF.lnRatio * lnRatio;

      if (partial) LP = (LP - COEFF.intercept) * shrink + COEFF.intercept;

      // Risk formula
      const exponent = Math.exp(LP);
      const risk = 1 - Math.pow(base.S0, exponent);
      let pct = Math.max(0, Math.min(0.95, risk)) * 100 * base.scale;
      pct = Math.max(0, Math.min(95, pct));

      const t = tier(pct);

      return {
        ok: true,
        pct: pct,
        tier: t,
        assumptions,
        partial
      };
    }

    function fmtPct(x) {
      if (x == null) return "—";
      if (x < 1) return x.toFixed(1) + "%";
      if (x < 10) return x.toFixed(1) + "%";
      return x.toFixed(0) + "%";
    }

    function updateRegion(regionKey, result) {
      const id = regionKey;
      const riskEl = document.getElementById(id + "-risk");
      const tierEl = document.getElementById(id + "-tier");
      const badgeEl = document.getElementById(id + "-badge");
      const assumpEl = document.getElementById(id + "-assump");
      const partialEl = document.getElementById(id + "-partial");

      if (!result.ok) {
        riskEl.textContent = "—";
        tierEl.textContent = "—";
        tierEl.className = "badge";
        badgeEl.textContent = result.message || "Awaiting input";
        assumpEl.textContent = "—";
        partialEl.textContent = "—";
        return;
      }

      riskEl.textContent = fmtPct(result.pct);
      tierEl.textContent = result.tier.label;
      tierEl.className = "badge " + result.tier.cls;
      badgeEl.textContent = "Calculated";
      assumpEl.textContent = result.assumptions.length ? result.assumptions.join(" · ") : "None";
      partialEl.textContent = result.partial ? "Partial (missing predictors)" : "Complete";
    }

    function readInputs() {
      return {
        age: parseFloatOrNull(document.getElementById("age").value),
        sex: document.getElementById("sex").value || "",
        smoker: document.getElementById("smoker").value || "",
        sbp: parseFloatOrNull(document.getElementById("sbp").value),
        chol: parseFloatOrNull(document.getElementById("chol").value),
        hdl: parseFloatOrNull(document.getElementById("hdl").value),
        diabetes: document.getElementById("diabetes").value || "",
        region: document.getElementById("region").value || ""
      };
    }

    function calculateAll() {
      const inputs = readInputs();

      // Compute for each region regardless of selected reference
      const regions = ["americas", "europe", "asia"];
      for (const r of regions) {
        const res = computeRisk(r, inputs);
        updateRegion(r, res);
      }
    }

    // Live update on input
    const ids = ["age","sex","smoker","sbp","chol","hdl","diabetes","region"];
    ids.forEach(id => {
      document.getElementById(id).addEventListener("input", calculateAll);
      document.getElementById(id).addEventListener("change", calculateAll);
    });

    document.getElementById("calcBtn").addEventListener("click", calculateAll);
    document.getElementById("resetBtn").addEventListener("click", () => {
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el.tagName === "SELECT") el.selectedIndex = 0;
        else el.value = "";
      });
      ["americas","europe","asia"].forEach(r => {
        updateRegion(r, { ok:false, message:"Awaiting input" });
      });
    });

    document.getElementById("advancedToggle").addEventListener("change", (e) => {
      document.getElementById("advanced").style.display = e.target.checked ? "block" : "none";
    });

    // Initialize
    ["americas","europe","asia"].forEach(r => {
      updateRegion(r, { ok:false, message:"Awaiting input" });
    });
  </script>
</body>
</html>
```
